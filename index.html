<!DOCTYPE html>
<html>
<head>
	<meta http-equiv='content-type' content='text/html; charset=utf-8' />
	<title>sample</title>
	<style type="text/css">
		html, body {
        	height: 100%;
        	width: 100%;
			margin: 0;
			padding: 0;
		}
		#map {
			height: 100%;
			width: 100%;
		}
	</style>
	<script type='text/javascript' src='https://api-auth-pre.mapfan.com/v2/jslib/js/map/mfjsapi'></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
	<script type='text/javascript'>
		
		//### 認証処理と地図APIサーバ設定 ###
		window.onload = function() {
			Mfapi.mapHost = 'api-map-pre.mapfan.com';
			// ルートAPIサーバを設定します。
			Mfapi.routeHost = 'api-route-pre.mapfan.com';
			// ※ appidはお客様の認証ＩＤを設定してください。
			Mfapi.auth('68254520d0a2d137e826442d68cef1f2f683ac3d24eb1ca4', task_func);
		}
		
		//### 認証後コールバック関数 ###
		function task_func(authStatus) {
			//### 認証結果確認 ###
			if( authStatus != 'success' ) {
				return;
			}
			//### 地図作成条件の設定 ###
			var options = {
				mapScale : 16,
				logoSettings : "on",
				contour: "on",
				bldgName : "on",
				landmarkIcon: "on",
			};
			//### 地図作成処理 ###
			Mfapi.mapCreate('map',options);
			
			//### ジオメトリーレイヤー作成処理 ###
			// ポイントを表示するためのジオメトリレイヤーを作成します。
			Mfapi.Map.addGeometryLayer('gLayer');
			
			// GeoJSONのフィーチャーのスタイル関数を作成します。
			var styleFunction = function(feature) {
				var style;
				// フィーチャーのGeometryタイプ毎に指定する場合
				switch (feature.geometry.type) {
					// case 'Point':
					// case 'MultiPoint':
					// 	style = new Mfapi.Map.GeoJSONStyle.Point();
					// 	style.imageUrl = './img/marker-red.png';
					// 	break;
					// case 'LineString':
					// case 'MultiLineString':
					// 	style = new Mfapi.Map.GeoJSONStyle.LineString();
					// 	style.lineColor = '#00ff00';
					// 	style.lineWidth = 2;
					// 	break;
					case 'Polygon':
					case 'MultiPolygon':
						style = new Mfapi.Map.GeoJSONStyle.Polygon();
						style.edgeColor = '#0000ff';
						style.edgeWidth = 2;
						style.fillColor = '#0080ff';
						break;
					case 'GeometryCollection':
						style = new Mfapi.Map.GeoJSONStyle.GeometryCollection();
						style.imageUrl = './img/marker-blue.png';
						style.edgeColor = '#ffaa00';
						style.edgeWidth = 2;
						style.fillColor = '#ffffcc';
						break;
				}
				return style;
			};
			
			//GeoJSON_Sample.jsonのサンプルを指定してGeoJSONレイヤーの作成条件を作成します。
			var layerOptions = {
				url: './data/geojson/tokyo23.geojson',
				styleFunction: styleFunction
			};
			
			//GeoJSONレイヤーを作成します。
			Mfapi.Map.addGeoJSONLayer('geoJSONLayer', layerOptions);

			html2canvas(document.querySelector("#map"), {
				allowTaint: true,
				foreignObjectRendering: true,
			})
				.then(canvas => {
					console.log("hello")
					let downloadEle = document.createElement("a");
					donwloadEle.href = canvas.toDataURL("image/png");
					donloadEle.download = "map.png";
					downloadEle.click();
			});

		}
	</script>
</head>
<body>
	<div id='map' draggable="true"></div>
</body>
</html>
